<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Rafa-Ximometro.io üîã</title>
 <!-- INCLUIR FIREBASE -->
 <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
 <style>
  body {
  margin: 0;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-image: linear-gradient(to right top, #2e8b57, #00957d, #009ea2, #00a4c2, #31a7d9, #54a8e4, #74a8ec, #92a8f0, #9ea7f6, #aba5fa, #b9a3fd, #c9a0ff);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start; /* Cambiado para mejor distribuci√≥n */
  color: white;
  text-align: center;
  }

  .header {
  margin-bottom: 20px;
  width: 100%;
  max-width: 500px;
  }

  .logo {
  font-size: 2.5em;
  margin: 0 0 10px 0;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .tagline {
  opacity: 0.9;
  margin-bottom: 10px;
  font-size: 1em;
  }

  .sync-status {
  font-size: 0.9em;
  opacity: 0.8;
  margin-bottom: 10px;
  font-weight: bold;
  }

  .container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 25px;
  max-width: 500px; /* Aumentado el ancho m√°ximo */
  width: 100%;
  flex: 1;
  }

  .energy-section {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 10px 0;
  width: 100%;
  }

  .energy-bar-container {
  position: relative;
  width: 120px; /* M√°s ancho */
  height: 300px; /* M√°s alto */
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  border: 3px solid white;
  overflow: hidden;
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
  }

  .energy-bar {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: linear-gradient(to bottom, #00ff00, #ffff00, #ff4444);
  height: 100%;
  }

  .marker {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 2.2em; /* Emojis m√°s grandes */
  filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
  z-index: 10;
  transition: top 0.5s ease;
  }

  .status-container {
  display: flex;
  flex-direction: column;
  gap: 25px; /* M√°s espacio entre tarjetas */
  width: 100%;
  max-width: 400px;
  }

  .person-status {
  display: flex;
  align-items: center;
  gap: 20px; /* M√°s espacio entre elementos */
  padding: 20px; /* M√°s padding */
  background: rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(10px);
  }

  .person-emoji {
  font-size: 2.5em; /* Emojis m√°s grandes */
  filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
  min-width: 60px; /* Espacio consistente */
  }

  .person-info {
  text-align: left;
  flex: 1;
  }

  .person-name {
  font-weight: bold;
  font-size: 1.3em; /* Texto m√°s grande */
  margin-bottom: 8px;
  }

  .person-battery {
  font-size: 1em; /* Texto m√°s legible */
  opacity: 0.9;
  line-height: 1.4;
  }

  .last-update {
  font-size: 0.85em;
  opacity: 0.7;
  margin-top: 10px;
  padding: 10px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  width: 100%;
  max-width: 400px;
  }

  /* Mejoras para m√≥viles */
  @media (max-width: 480px) {
  .header {
    margin-bottom: 15px;
  }
  
  .logo {
    font-size: 2.2em;
  }
  
  .tagline {
    font-size: 0.9em;
  }
  
  .energy-bar-container {
    width: 100px;
    height: 250px;
  }
  
  .marker {
    font-size: 1.8em;
  }
  
  .person-status {
    padding: 15px;
    gap: 15px;
  }
  
  .person-emoji {
    font-size: 2em;
    min-width: 50px;
  }
  
  .person-name {
    font-size: 1.2em;
  }
  
  .status-container {
    gap: 20px;
  }
  }

  @media (max-width: 350px) {
  .logo {
    font-size: 1.8em;
  }
  
  .energy-bar-container {
    width: 90px;
    height: 220px;
  }
  
  .person-status {
    padding: 12px;
  }
  }
 </style>
</head>
<body>
 <!-- HEADER MEJORADO Y SEPARADO -->
 <div class="header">
  <h1 class="logo">üîã Rafa-Ximometro.io</h1>
  <p class="tagline">Vista combinada de energ√≠a ‚ú®</p>
  <div class="sync-status" id="syncStatus">üü° Conectando...</div>
 </div>
 
 <!-- CONTENIDO PRINCIPAL M√ÅS ESPACIOSO -->
 <div class="container">
  <div class="energy-section">
   <div class="energy-bar-container">
    <div class="energy-bar" id="energyBar"></div>
    <div class="marker" id="rafaMarker" style="top: 150px;">üßîüèª</div>
    <div class="marker" id="ximenaMarker" style="top: 150px;">ü•∑üèª</div>
   </div>
  </div>

  <div class="status-container">
   <div class="person-status">
    <div class="person-emoji" id="rafaEmoji">üßîüèª</div>
    <div class="person-info">
     <div class="person-name">Rafa</div>
     <div class="person-battery" id="rafaBattery">Cargando...</div>
    </div>
   </div>

   <div class="person-status">
    <div class="person-emoji" id="ximenaEmoji">ü•∑üèª</div>
    <div class="person-info">
     <div class="person-name">Ximena</div>
     <div class="person-battery" id="ximenaBattery">Cargando...</div>
    </div>
   </div>
  </div>
  
  <div class="last-update">
   Actualizado: <span id="lastUpdate">Cargando...</span>
  </div>
 </div>

 <script>
  // =============================================
  // CONFIGURACI√ìN DE FIREBASE
  // =============================================
  const firebaseConfig = {
  apiKey: "AIzaSyC9SZzsrV-xYwQsREScGt0sT6VSK6mPhVw",
  authDomain: "ximometro1.firebaseapp.com",
  databaseURL: "https://ximometro1-default-rtdb.firebaseio.com",
  projectId: "ximometro1",
  storageBucket: "ximometro1.firebasestorage.app",
  messagingSenderId: "417707299028",
  appId: "1:417707299028:web:7f317639f4f137fd45eb41"
  };

  // Inicializar Firebase
  let database;
  try {
  firebase.initializeApp(firebaseConfig);
  database = firebase.database();
  console.log("Firebase conectado correctamente");
  } catch (error) {
  console.log("Error Firebase:", error);
  }

  const syncStatus = document.getElementById('syncStatus');
  const lastUpdate = document.getElementById('lastUpdate');
  const rafaMarker = document.getElementById('rafaMarker');
  const ximenaMarker = document.getElementById('ximenaMarker');
  const rafaEmoji = document.getElementById('rafaEmoji');
  const ximenaEmoji = document.getElementById('ximenaEmoji');
  const rafaBattery = document.getElementById('rafaBattery');
  const ximenaBattery = document.getElementById('ximenaBattery');

  let rafaData = { battery: 50, emoji: 'ü¶∏üèª' };
  let ximenaData = { battery: 50, emoji: 'ü•∑üèª' };

  // =============================================
  // SINCRONIZACI√ìN CON FIREBASE
  // =============================================

  function loadFromDatabase() {
  if (!database) {
   syncStatus.textContent = "üü° Modo local - Sin sincronizaci√≥n";
   return;
  }
  
  // Cargar datos de Rafa
  database.ref('ximometro/rafa/status').on('value', (snapshot) => {
   const data = snapshot.val();
   if (data) {
    rafaData = {
    battery: data.battery || 50,
    emoji: data.selectedEmoji || 'ü¶∏üèª'
    };
    updateDisplay();
    updateLastUpdate();
   }
  });

  // Cargar datos de Ximena
  database.ref('ximometro/ximena/status').on('value', (snapshot) => {
   const data = snapshot.val();
   if (data) {
    ximenaData = {
    battery: data.battery || 50,
    emoji: data.selectedEmoji || 'ü•∑üèª'
    };
    updateDisplay();
    updateLastUpdate();
   }
  });
  }

  function updateDisplay() {
  // Actualizar posici√≥n de marcadores (arriba = 0%, abajo = 100%)
  const barHeight = 300; // Nueva altura de la barra
  const markerHeight = 50; // Altura aproximada del emoji m√°s grande
  
  const rafaPosition = barHeight - (rafaData.battery / 100) * barHeight - (markerHeight / 2);
  const ximenaPosition = barHeight - (ximenaData.battery / 100) * barHeight - (markerHeight / 2);
  
  rafaMarker.style.top = Math.max(0, Math.min(barHeight - markerHeight, rafaPosition)) + 'px';
  ximenaMarker.style.top = Math.max(0, Math.min(barHeight - markerHeight, ximenaPosition)) + 'px';

  // Actualizar emojis en ambos lugares
  rafaMarker.textContent = rafaData.emoji;
  rafaEmoji.textContent = rafaData.emoji;
  
  ximenaMarker.textContent = ximenaData.emoji;
  ximenaEmoji.textContent = ximenaData.emoji;

  // Actualizar textos de bater√≠a
  rafaBattery.innerHTML = getBatteryText(rafaData.battery, 'Rafa');
  ximenaBattery.innerHTML = getBatteryText(ximenaData.battery, 'Ximena');

  syncStatus.textContent = "üü¢ Sincronizado en tiempo real";
  syncStatus.style.color = "#90EE90";
  }

  function getBatteryText(percentage, name) {
  let status, emoji;
  
  if (percentage >= 80) {
   status = "¬°Energ√≠a al m√°ximo!";
   emoji = name === 'Rafa' ? "üöÄ" : "üéØ";
  } else if (percentage >= 60) {
   status = "Buen nivel de energ√≠a";
   emoji = "‚ú®";
  } else if (percentage >= 40) {
   status = "Energ√≠a moderada";
   emoji = "üí´";
  } else if (percentage >= 20) {
   status = "Poca energ√≠a";
   emoji = "üå´Ô∏è";
  } else {
   status = "Sin energ√≠a";
   emoji = "üí§";
  }
  
  return `<strong>${percentage}%</strong> - ${status} ${emoji}`;
  }

  function updateLastUpdate() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('es-MX', { 
   hour: '2-digit', 
   minute: '2-digit',
   second: '2-digit'
  });
  lastUpdate.textContent = timeString;
  }

  // Cargar al iniciar
  window.addEventListener('load', function() {
  loadFromDatabase();
  });

  // Actualizar autom√°ticamente cada 30 segundos
  setInterval(updateLastUpdate, 30000);
 </script>
</body>
</html>